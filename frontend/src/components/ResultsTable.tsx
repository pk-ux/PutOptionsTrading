/**
 * Results table component
 * - Portions generated by AI
 */

import type { OptionResult } from '@/types';

interface ResultsTableProps {
  data: OptionResult[];
  title: string;
}

function formatCurrency(value: number | undefined): string {
  if (value === undefined || value === null) return '';
  return `$${value.toFixed(2)}`;
}

function formatPercent(value: number | undefined): string {
  if (value === undefined || value === null) return '';
  return `${value.toFixed(1)}%`;
}

function getReturnClass(value: number): string {
  if (value >= 50) return 'return-high';
  if (value >= 30) return 'return-medium';
  return 'return-low';
}

export function ResultsTable({ data, title }: ResultsTableProps) {
  if (!data || data.length === 0) {
    return (
      <div className="text-center text-gray-400 py-8">
        No results for {title}
      </div>
    );
  }

  return (
    <div className="overflow-x-auto rounded-xl shadow-lg shadow-black/20 border border-white/5">
      <table className="data-table">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Price</th>
            <th>Strike</th>
            <th>Premium</th>
            <th>Return</th>
            <th>Daily Decay</th>
            <th>Prob Assign</th>
            <th>Expiry</th>
            <th>DTE</th>
            <th>Vol</th>
            <th>OI</th>
            <th>IV</th>
          </tr>
        </thead>
        <tbody>
          {data.map((row, index) => {
            const premium = row.premium ?? row.lastPrice ?? 0;
            const dte = row.dte ?? row.calendar_days ?? 0;
            const oi = row.open_interest ?? row.openInterest ?? 0;
            const iv = row.implied_volatility ?? row.impliedVolatility ?? 0;
            
            return (
              <tr key={`${row.symbol}-${row.strike}-${row.expiry}-${index}`}>
                <td className="font-medium">{row.symbol}</td>
                <td>{formatCurrency(row.current_price)}</td>
                <td>{formatCurrency(row.strike)}</td>
                <td>{formatCurrency(premium)}</td>
                <td>
                  <span className={getReturnClass(row.annualized_return)}>
                    {formatPercent(row.annualized_return)}
                  </span>
                </td>
                <td>{row.daily_decay_contract ? `$${row.daily_decay_contract.toFixed(4)}` : '-'}</td>
                <td>{formatPercent(row.prob_assign)}</td>
                <td>{row.expiry}</td>
                <td>{dte}</td>
                <td>{row.volume}</td>
                <td>{oi}</td>
                <td>{formatPercent(iv)}</td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}
